<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Embedded Music Player</title>
<style>
  :root{--bg:rgba(0,0,0,0.72);--glass:rgba(255,255,255,0.06)}
  body{margin:0;font-family:Inter,system-ui,Arial,Helvetica,sans-serif;background:transparent}
  /* floating player */
  .player{
    position:fixed;
    right:18px;
    bottom:18px;
    z-index:2147483647;
    display:flex;
    gap:10px;
    align-items:center;
    background:var(--bg);
    padding:8px 12px;
    border-radius:999px;
    color:#fff;
    box-shadow:0 6px 20px rgba(0,0,0,0.25);
    backdrop-filter: blur(6px);
  }
  .player button{background:none;border:none;color:inherit;font-size:18px;cursor:pointer;padding:6px}
  .player input[type=range]{width:120px}
  .label{font-size:13px}
  /* initial click prompt overlay */
  .prompt{
    position:fixed; left:0; right:0; top:0; bottom:0;
    display:flex; align-items:center; justify-content:center;
    z-index:2147483000;
    pointer-events:auto;
  }
  .prompt .box{
    background:var(--glass);
    padding:18px 22px; border-radius:12px; color:#fff;
    box-shadow:0 8px 30px rgba(0,0,0,0.35); text-align:center;
  }
  .hidden{display:none}
  a.small{display:block;margin-top:8px;color:rgba(255,255,255,0.8);font-size:13px}
</style>
</head>
<body>
  <!-- Audio (relative path) -->
  <audio id="bgAudio" loop preload="auto">
    <source src="audio/funny-music-319843.mp3" type="audio/mpeg">
    Your browser does not support audio.
  </audio>

  <!-- Floating player -->
  <div class="player" id="player" aria-hidden="true">
    <button id="playBtn" aria-pressed="false" title="Play / Pause">►</button>
    <span class="label" id="status">Play music</span>
    <input id="vol" type="range" min="0" max="1" step="0.01" value="0.6" aria-label="Volume">
  </div>

  <!-- Click-to-enable prompt (shown if autoplay blocked) -->
  <div class="prompt" id="prompt" aria-hidden="false">
    <div class="box">
      <div style="font-size:16px;font-weight:600">Tap anywhere to enable site music</div>
      <div style="margin-top:8px;font-size:13px;color:rgba(255,255,255,0.86)">Autoplay with sound is blocked by many browsers — this tap lets the player start.</div>
      <a href="#" id="skip" class="small">Continue without sound</a>
    </div>
  </div>

<script>
  const audio = document.getElementById('bgAudio');
  const playBtn = document.getElementById('playBtn');
  const status = document.getElementById('status');
  const vol = document.getElementById('vol');
  const prompt = document.getElementById('prompt');
  const player = document.getElementById('player');

  // Restore volume and playing state
  audio.volume = parseFloat(localStorage.getItem('musicVolume') || '0.6');
  vol.value = audio.volume;
  const wantPlay = localStorage.getItem('musicPlaying') === 'true';

  function updateUI() {
    if (audio.paused) {
      playBtn.textContent = '►';
      status.textContent = 'Play music';
      playBtn.setAttribute('aria-pressed','false');
      player.setAttribute('aria-hidden','true');
    } else {
      playBtn.textContent = '❚❚';
      status.textContent = 'Pause';
      playBtn.setAttribute('aria-pressed','true');
      player.setAttribute('aria-hidden','false');
    }
  }

  // Try to autoplay (may be blocked)
  audio.play().then(()=> {
    // autoplay succeeded
    prompt.classList.add('hidden');
    updateUI();
    localStorage.setItem('musicPlaying','true');
  }).catch(()=> {
    // autoplay blocked — show prompt until user interacts
    prompt.classList.remove('hidden');
    updateUI();
  });

  // User gesture to start playback (click or key)
  function userGestureStart(e){
    audio.play().then(()=> {
      prompt.classList.add('hidden');
      updateUI();
      localStorage.setItem('musicPlaying','true');
    }).catch(()=> {
      // still blocked; keep prompt visible
    });
    // remove one-time listeners
    document.removeEventListener('click', userGestureStart);
    document.removeEventListener('keydown', userGestureStart);
    document.removeEventListener('touchstart', userGestureStart);
  }
  document.addEventListener('click', userGestureStart, {passive:true});
  document.addEventListener('keydown', userGestureStart, {passive:true});
  document.addEventListener('touchstart', userGestureStart, {passive:true});

  // Skip link (continue without sound)
  document.getElementById('skip').addEventListener('click', function(ev){
    ev.preventDefault();
    prompt.classList.add('hidden');
    localStorage.setItem('musicPlaying','false');
  });

  // Play/pause button
  playBtn.addEventListener('click', function(){
    if (audio.paused) {
      audio.play();
      localStorage.setItem('musicPlaying','true');
    } else {
      audio.pause();
      localStorage.setItem('musicPlaying','false');
    }
    updateUI();
  });

  // Volume control
  vol.addEventListener('input', function(){
    audio.volume = parseFloat(this.value);
    localStorage.setItem('musicVolume', audio.volume.toString());
  });

  // Reflect play/pause if changed elsewhere
  audio.addEventListener('play', updateUI);
  audio.addEventListener('pause', updateUI);

  // If user previously wanted play, try again when user interacts
  if (wantPlay) {
    const retry = () => {
      audio.play().then(()=> {
        prompt.classList.add('hidden');
        updateUI();
      }).catch(()=>{});
      document.removeEventListener('click', retry);
    };
    document.addEventListener('click', retry, {passive:true});
  }
</script>
</body>
</html>
